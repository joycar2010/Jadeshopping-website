<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ¥è¯¢å‰ç«¯ç½‘ç«™ç”¨æˆ·æ•°æ®</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .user-table th,
        .user-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .user-table th {
            background-color: #3498db;
            color: white;
        }
        .user-table tr:hover {
            background-color: #f5f5f5;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-active { background-color: #2ecc71; color: white; }
        .status-inactive { background-color: #95a5a6; color: white; }
        .status-suspended { background-color: #f39c12; color: white; }
        .status-banned { background-color: #e74c3c; color: white; }
        .membership-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .membership-bronze { background-color: #cd7f32; color: white; }
        .membership-silver { background-color: #c0c0c0; color: black; }
        .membership-gold { background-color: #ffd700; color: black; }
        .membership-platinum { background-color: #e5e4e2; color: black; }
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        .json-display {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å‰ç«¯ç½‘ç«™ç”¨æˆ·æ•°æ®æŸ¥è¯¢æŠ¥å‘Š</h1>
        
        <button class="refresh-btn" onclick="queryUserData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
        
        <div id="report-content">
            <!-- æŠ¥å‘Šå†…å®¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <script>
        function queryUserData() {
            const reportContent = document.getElementById('report-content');
            
            try {
                // è·å– localStorage æ•°æ®
                const usersData = localStorage.getItem('jade-shopping-users');
                const storeData = localStorage.getItem('jade-shopping-store');
                
                let report = '';
                
                // 1. åŸºæœ¬æ•°æ®æ¦‚è§ˆ
                report += generateBasicOverview(usersData, storeData);
                
                // 2. ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯
                if (usersData) {
                    const users = JSON.parse(usersData);
                    report += generateUserStats(users);
                    report += generateMembershipDistribution(users);
                    report += generateRecentUsers(users);
                    report += generateUserTable(users);
                } else {
                    report += '<div class="section"><h2>ğŸ“Š ç”¨æˆ·æ•°æ®</h2><div class="no-data">æš‚æ— ç”¨æˆ·æ•°æ®</div></div>';
                }
                
                // 3. å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯
                report += generateCurrentUserInfo(storeData);
                
                // 4. åŸå§‹æ•°æ®å±•ç¤º
                report += generateRawDataSection(usersData, storeData);
                
                reportContent.innerHTML = report;
                
            } catch (error) {
                reportContent.innerHTML = `
                    <div class="section" style="border-color: #e74c3c;">
                        <h2 style="color: #e74c3c;">âŒ æŸ¥è¯¢å¤±è´¥</h2>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    </div>
                `;
                console.error('æŸ¥è¯¢ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
            }
        }
        
        function generateBasicOverview(usersData, storeData) {
            const userCount = usersData ? JSON.parse(usersData).length : 0;
            const hasCurrentUser = storeData ? JSON.parse(storeData).state?.isAuthenticated : false;
            const currentTime = new Date().toLocaleString('zh-CN');
            
            return `
                <div class="section">
                    <h2>ğŸ“ˆ æ•°æ®æ¦‚è§ˆ</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${userCount}</div>
                            <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${hasCurrentUser ? '1' : '0'}</div>
                            <div class="stat-label">å½“å‰ç™»å½•ç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${usersData ? 'âœ“' : 'âœ—'}</div>
                            <div class="stat-label">ç”¨æˆ·æ•°æ®çŠ¶æ€</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${storeData ? 'âœ“' : 'âœ—'}</div>
                            <div class="stat-label">å­˜å‚¨çŠ¶æ€</div>
                        </div>
                    </div>
                    <p><strong>æŸ¥è¯¢æ—¶é—´:</strong> ${currentTime}</p>
                </div>
            `;
        }
        
        function generateUserStats(users) {
            const stats = {
                total: users.length,
                active: users.filter(u => u.status === 'active').length,
                inactive: users.filter(u => u.status === 'inactive').length,
                suspended: users.filter(u => u.status === 'suspended').length,
                banned: users.filter(u => u.status === 'banned').length,
                emailVerified: users.filter(u => u.email_verified).length,
                phoneVerified: users.filter(u => u.phone_verified).length
            };
            
            return `
                <div class="section">
                    <h2>ğŸ“Š ç”¨æˆ·çŠ¶æ€ç»Ÿè®¡</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${stats.active}</div>
                            <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.inactive}</div>
                            <div class="stat-label">éæ´»è·ƒç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.suspended}</div>
                            <div class="stat-label">æš‚åœç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.banned}</div>
                            <div class="stat-label">å°ç¦ç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.emailVerified}</div>
                            <div class="stat-label">é‚®ç®±å·²éªŒè¯</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.phoneVerified}</div>
                            <div class="stat-label">æ‰‹æœºå·²éªŒè¯</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateMembershipDistribution(users) {
            const membership = {
                bronze: users.filter(u => u.membership_level === 'bronze').length,
                silver: users.filter(u => u.membership_level === 'silver').length,
                gold: users.filter(u => u.membership_level === 'gold').length,
                platinum: users.filter(u => u.membership_level === 'platinum').length
            };
            
            return `
                <div class="section">
                    <h2>ğŸ’ ä¼šå‘˜ç­‰çº§åˆ†å¸ƒ</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${membership.bronze}</div>
                            <div class="stat-label">é’é“œä¼šå‘˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.silver}</div>
                            <div class="stat-label">ç™½é“¶ä¼šå‘˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.gold}</div>
                            <div class="stat-label">é»„é‡‘ä¼šå‘˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.platinum}</div>
                            <div class="stat-label">é“‚é‡‘ä¼šå‘˜</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateRecentUsers(users) {
            // æŒ‰æ³¨å†Œæ—¶é—´æ’åºï¼Œè·å–æœ€è¿‘5ä¸ªç”¨æˆ·
            const recentUsers = users
                .sort((a, b) => new Date(b.created_at || b.registration_date) - new Date(a.created_at || a.registration_date))
                .slice(0, 5);
            
            let tableRows = '';
            recentUsers.forEach(user => {
                const registrationDate = new Date(user.created_at || user.registration_date).toLocaleString('zh-CN');
                tableRows += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td><span class="status-badge status-${user.status}">${getStatusText(user.status)}</span></td>
                        <td><span class="membership-badge membership-${user.membership_level}">${getMembershipText(user.membership_level)}</span></td>
                        <td>${registrationDate}</td>
                    </tr>
                `;
            });
            
            return `
                <div class="section">
                    <h2>ğŸ†• æœ€è¿‘æ³¨å†Œç”¨æˆ· (æœ€æ–°5ä¸ª)</h2>
                    ${recentUsers.length > 0 ? `
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>ç”¨æˆ·å</th>
                                    <th>é‚®ç®±</th>
                                    <th>çŠ¶æ€</th>
                                    <th>ä¼šå‘˜ç­‰çº§</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    ` : '<div class="no-data">æš‚æ— ç”¨æˆ·æ•°æ®</div>'}
                </div>
            `;
        }
        
        function generateUserTable(users) {
            let tableRows = '';
            users.forEach(user => {
                const registrationDate = new Date(user.created_at || user.registration_date).toLocaleString('zh-CN');
                const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString('zh-CN') : 'ä»æœªç™»å½•';
                tableRows += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.full_name || 'æœªè®¾ç½®'}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || 'æœªè®¾ç½®'}</td>
                        <td><span class="status-badge status-${user.status}">${getStatusText(user.status)}</span></td>
                        <td><span class="membership-badge membership-${user.membership_level}">${getMembershipText(user.membership_level)}</span></td>
                        <td>${user.total_orders || 0}</td>
                        <td>Â¥${(user.total_spent || 0).toFixed(2)}</td>
                        <td>${registrationDate}</td>
                        <td>${lastLogin}</td>
                    </tr>
                `;
            });
            
            return `
                <div class="section">
                    <h2>ğŸ‘¥ æ‰€æœ‰ç”¨æˆ·è¯¦ç»†ä¿¡æ¯</h2>
                    ${users.length > 0 ? `
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>ç”¨æˆ·å</th>
                                    <th>å§“å</th>
                                    <th>é‚®ç®±</th>
                                    <th>æ‰‹æœº</th>
                                    <th>çŠ¶æ€</th>
                                    <th>ä¼šå‘˜ç­‰çº§</th>
                                    <th>è®¢å•æ•°</th>
                                    <th>æ¶ˆè´¹é‡‘é¢</th>
                                    <th>æ³¨å†Œæ—¶é—´</th>
                                    <th>æœ€åç™»å½•</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    ` : '<div class="no-data">æš‚æ— ç”¨æˆ·æ•°æ®</div>'}
                </div>
            `;
        }
        
        function generateCurrentUserInfo(storeData) {
            if (!storeData) {
                return `
                    <div class="section">
                        <h2>ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·</h2>
                        <div class="no-data">æ— å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯</div>
                    </div>
                `;
            }
            
            try {
                const store = JSON.parse(storeData);
                const user = store.state?.user;
                const isAuthenticated = store.state?.isAuthenticated;
                
                if (!isAuthenticated || !user) {
                    return `
                        <div class="section">
                            <h2>ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·</h2>
                            <div class="no-data">å½“å‰æ— ç”¨æˆ·ç™»å½•</div>
                        </div>
                    `;
                }
                
                return `
                    <div class="section">
                        <h2>ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${user.username}</div>
                                <div class="stat-label">ç”¨æˆ·å</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${user.full_name || 'æœªè®¾ç½®'}</div>
                                <div class="stat-label">å§“å</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${user.email}</div>
                                <div class="stat-label">é‚®ç®±</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">Â¥${(user.balance || 0).toFixed(2)}</div>
                                <div class="stat-label">è´¦æˆ·ä½™é¢</div>
                            </div>
                        </div>
                        <p><strong>ç”¨æˆ·ID:</strong> ${user.id}</p>
                        <p><strong>æ‰‹æœºå·:</strong> ${user.phone || 'æœªè®¾ç½®'}</p>
                        <p><strong>åˆ›å»ºæ—¶é—´:</strong> ${user.created_at ? new Date(user.created_at).toLocaleString('zh-CN') : 'æœªçŸ¥'}</p>
                        <p><strong>æ›´æ–°æ—¶é—´:</strong> ${user.updated_at ? new Date(user.updated_at).toLocaleString('zh-CN') : 'æœªçŸ¥'}</p>
                    </div>
                `;
            } catch (error) {
                return `
                    <div class="section">
                        <h2>ğŸ‘¤ å½“å‰ç™»å½•ç”¨æˆ·</h2>
                        <div class="no-data">è§£æç”¨æˆ·æ•°æ®å¤±è´¥: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        function generateRawDataSection(usersData, storeData) {
            return `
                <div class="section">
                    <h2>ğŸ”§ åŸå§‹æ•°æ®</h2>
                    <h3>jade-shopping-users æ•°æ®:</h3>
                    <div class="json-display">
                        ${usersData ? JSON.stringify(JSON.parse(usersData), null, 2) : 'æ— æ•°æ®'}
                    </div>
                    <h3>jade-shopping-store æ•°æ®:</h3>
                    <div class="json-display">
                        ${storeData ? JSON.stringify(JSON.parse(storeData), null, 2) : 'æ— æ•°æ®'}
                    </div>
                </div>
            `;
        }
        
        function getStatusText(status) {
            const statusMap = {
                'active': 'æ´»è·ƒ',
                'inactive': 'éæ´»è·ƒ',
                'suspended': 'æš‚åœ',
                'banned': 'å°ç¦'
            };
            return statusMap[status] || status;
        }
        
        function getMembershipText(level) {
            const levelMap = {
                'bronze': 'é’é“œ',
                'silver': 'ç™½é“¶',
                'gold': 'é»„é‡‘',
                'platinum': 'é“‚é‡‘'
            };
            return levelMap[level] || level;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æŸ¥è¯¢æ•°æ®
        window.onload = function() {
            queryUserData();
        };
    </script>
</body>
</html>