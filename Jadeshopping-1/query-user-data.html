<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>查询前端网站用户数据</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .section h2 {
            color: #34495e;
            margin-top: 0;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #3498db;
        }
        .stat-label {
            color: #7f8c8d;
            margin-top: 5px;
        }
        .user-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .user-table th,
        .user-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        .user-table th {
            background-color: #3498db;
            color: white;
        }
        .user-table tr:hover {
            background-color: #f5f5f5;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-active { background-color: #2ecc71; color: white; }
        .status-inactive { background-color: #95a5a6; color: white; }
        .status-suspended { background-color: #f39c12; color: white; }
        .status-banned { background-color: #e74c3c; color: white; }
        .membership-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .membership-bronze { background-color: #cd7f32; color: white; }
        .membership-silver { background-color: #c0c0c0; color: black; }
        .membership-gold { background-color: #ffd700; color: black; }
        .membership-platinum { background-color: #e5e4e2; color: black; }
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
        .refresh-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
        }
        .refresh-btn:hover {
            background-color: #2980b9;
        }
        .json-display {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 前端网站用户数据查询报告</h1>
        
        <button class="refresh-btn" onclick="queryUserData()">🔄 刷新数据</button>
        
        <div id="report-content">
            <!-- 报告内容将在这里动态生成 -->
        </div>
    </div>

    <script>
        function queryUserData() {
            const reportContent = document.getElementById('report-content');
            
            try {
                // 获取 localStorage 数据
                const usersData = localStorage.getItem('jade-shopping-users');
                const storeData = localStorage.getItem('jade-shopping-store');
                
                let report = '';
                
                // 1. 基本数据概览
                report += generateBasicOverview(usersData, storeData);
                
                // 2. 用户统计信息
                if (usersData) {
                    const users = JSON.parse(usersData);
                    report += generateUserStats(users);
                    report += generateMembershipDistribution(users);
                    report += generateRecentUsers(users);
                    report += generateUserTable(users);
                } else {
                    report += '<div class="section"><h2>📊 用户数据</h2><div class="no-data">暂无用户数据</div></div>';
                }
                
                // 3. 当前登录用户信息
                report += generateCurrentUserInfo(storeData);
                
                // 4. 原始数据展示
                report += generateRawDataSection(usersData, storeData);
                
                reportContent.innerHTML = report;
                
            } catch (error) {
                reportContent.innerHTML = `
                    <div class="section" style="border-color: #e74c3c;">
                        <h2 style="color: #e74c3c;">❌ 查询失败</h2>
                        <p>错误信息: ${error.message}</p>
                    </div>
                `;
                console.error('查询用户数据失败:', error);
            }
        }
        
        function generateBasicOverview(usersData, storeData) {
            const userCount = usersData ? JSON.parse(usersData).length : 0;
            const hasCurrentUser = storeData ? JSON.parse(storeData).state?.isAuthenticated : false;
            const currentTime = new Date().toLocaleString('zh-CN');
            
            return `
                <div class="section">
                    <h2>📈 数据概览</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${userCount}</div>
                            <div class="stat-label">总用户数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${hasCurrentUser ? '1' : '0'}</div>
                            <div class="stat-label">当前登录用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${usersData ? '✓' : '✗'}</div>
                            <div class="stat-label">用户数据状态</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${storeData ? '✓' : '✗'}</div>
                            <div class="stat-label">存储状态</div>
                        </div>
                    </div>
                    <p><strong>查询时间:</strong> ${currentTime}</p>
                </div>
            `;
        }
        
        function generateUserStats(users) {
            const stats = {
                total: users.length,
                active: users.filter(u => u.status === 'active').length,
                inactive: users.filter(u => u.status === 'inactive').length,
                suspended: users.filter(u => u.status === 'suspended').length,
                banned: users.filter(u => u.status === 'banned').length,
                emailVerified: users.filter(u => u.email_verified).length,
                phoneVerified: users.filter(u => u.phone_verified).length
            };
            
            return `
                <div class="section">
                    <h2>📊 用户状态统计</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${stats.active}</div>
                            <div class="stat-label">活跃用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.inactive}</div>
                            <div class="stat-label">非活跃用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.suspended}</div>
                            <div class="stat-label">暂停用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.banned}</div>
                            <div class="stat-label">封禁用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.emailVerified}</div>
                            <div class="stat-label">邮箱已验证</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${stats.phoneVerified}</div>
                            <div class="stat-label">手机已验证</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateMembershipDistribution(users) {
            const membership = {
                bronze: users.filter(u => u.membership_level === 'bronze').length,
                silver: users.filter(u => u.membership_level === 'silver').length,
                gold: users.filter(u => u.membership_level === 'gold').length,
                platinum: users.filter(u => u.membership_level === 'platinum').length
            };
            
            return `
                <div class="section">
                    <h2>💎 会员等级分布</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${membership.bronze}</div>
                            <div class="stat-label">青铜会员</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.silver}</div>
                            <div class="stat-label">白银会员</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.gold}</div>
                            <div class="stat-label">黄金会员</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${membership.platinum}</div>
                            <div class="stat-label">铂金会员</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateRecentUsers(users) {
            // 按注册时间排序，获取最近5个用户
            const recentUsers = users
                .sort((a, b) => new Date(b.created_at || b.registration_date) - new Date(a.created_at || a.registration_date))
                .slice(0, 5);
            
            let tableRows = '';
            recentUsers.forEach(user => {
                const registrationDate = new Date(user.created_at || user.registration_date).toLocaleString('zh-CN');
                tableRows += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td><span class="status-badge status-${user.status}">${getStatusText(user.status)}</span></td>
                        <td><span class="membership-badge membership-${user.membership_level}">${getMembershipText(user.membership_level)}</span></td>
                        <td>${registrationDate}</td>
                    </tr>
                `;
            });
            
            return `
                <div class="section">
                    <h2>🆕 最近注册用户 (最新5个)</h2>
                    ${recentUsers.length > 0 ? `
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>邮箱</th>
                                    <th>状态</th>
                                    <th>会员等级</th>
                                    <th>注册时间</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    ` : '<div class="no-data">暂无用户数据</div>'}
                </div>
            `;
        }
        
        function generateUserTable(users) {
            let tableRows = '';
            users.forEach(user => {
                const registrationDate = new Date(user.created_at || user.registration_date).toLocaleString('zh-CN');
                const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString('zh-CN') : '从未登录';
                tableRows += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.full_name || '未设置'}</td>
                        <td>${user.email}</td>
                        <td>${user.phone || '未设置'}</td>
                        <td><span class="status-badge status-${user.status}">${getStatusText(user.status)}</span></td>
                        <td><span class="membership-badge membership-${user.membership_level}">${getMembershipText(user.membership_level)}</span></td>
                        <td>${user.total_orders || 0}</td>
                        <td>¥${(user.total_spent || 0).toFixed(2)}</td>
                        <td>${registrationDate}</td>
                        <td>${lastLogin}</td>
                    </tr>
                `;
            });
            
            return `
                <div class="section">
                    <h2>👥 所有用户详细信息</h2>
                    ${users.length > 0 ? `
                        <table class="user-table">
                            <thead>
                                <tr>
                                    <th>用户名</th>
                                    <th>姓名</th>
                                    <th>邮箱</th>
                                    <th>手机</th>
                                    <th>状态</th>
                                    <th>会员等级</th>
                                    <th>订单数</th>
                                    <th>消费金额</th>
                                    <th>注册时间</th>
                                    <th>最后登录</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${tableRows}
                            </tbody>
                        </table>
                    ` : '<div class="no-data">暂无用户数据</div>'}
                </div>
            `;
        }
        
        function generateCurrentUserInfo(storeData) {
            if (!storeData) {
                return `
                    <div class="section">
                        <h2>👤 当前登录用户</h2>
                        <div class="no-data">无当前登录用户信息</div>
                    </div>
                `;
            }
            
            try {
                const store = JSON.parse(storeData);
                const user = store.state?.user;
                const isAuthenticated = store.state?.isAuthenticated;
                
                if (!isAuthenticated || !user) {
                    return `
                        <div class="section">
                            <h2>👤 当前登录用户</h2>
                            <div class="no-data">当前无用户登录</div>
                        </div>
                    `;
                }
                
                return `
                    <div class="section">
                        <h2>👤 当前登录用户</h2>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-number">${user.username}</div>
                                <div class="stat-label">用户名</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${user.full_name || '未设置'}</div>
                                <div class="stat-label">姓名</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${user.email}</div>
                                <div class="stat-label">邮箱</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">¥${(user.balance || 0).toFixed(2)}</div>
                                <div class="stat-label">账户余额</div>
                            </div>
                        </div>
                        <p><strong>用户ID:</strong> ${user.id}</p>
                        <p><strong>手机号:</strong> ${user.phone || '未设置'}</p>
                        <p><strong>创建时间:</strong> ${user.created_at ? new Date(user.created_at).toLocaleString('zh-CN') : '未知'}</p>
                        <p><strong>更新时间:</strong> ${user.updated_at ? new Date(user.updated_at).toLocaleString('zh-CN') : '未知'}</p>
                    </div>
                `;
            } catch (error) {
                return `
                    <div class="section">
                        <h2>👤 当前登录用户</h2>
                        <div class="no-data">解析用户数据失败: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        function generateRawDataSection(usersData, storeData) {
            return `
                <div class="section">
                    <h2>🔧 原始数据</h2>
                    <h3>jade-shopping-users 数据:</h3>
                    <div class="json-display">
                        ${usersData ? JSON.stringify(JSON.parse(usersData), null, 2) : '无数据'}
                    </div>
                    <h3>jade-shopping-store 数据:</h3>
                    <div class="json-display">
                        ${storeData ? JSON.stringify(JSON.parse(storeData), null, 2) : '无数据'}
                    </div>
                </div>
            `;
        }
        
        function getStatusText(status) {
            const statusMap = {
                'active': '活跃',
                'inactive': '非活跃',
                'suspended': '暂停',
                'banned': '封禁'
            };
            return statusMap[status] || status;
        }
        
        function getMembershipText(level) {
            const levelMap = {
                'bronze': '青铜',
                'silver': '白银',
                'gold': '黄金',
                'platinum': '铂金'
            };
            return levelMap[level] || level;
        }
        
        // 页面加载时自动查询数据
        window.onload = function() {
            queryUserData();
        };
    </script>
</body>
</html>